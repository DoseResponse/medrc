<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • medrc</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">medrc</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/medrc.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1></h1>
            
          </div>

    
    
<div class="contents">
<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{An introduction to the medrc package}
-->
<div id="an-introduction-to-the-package-medrc" class="section level1">
<h1 class="hasAnchor">
<a href="#an-introduction-to-the-package-medrc" class="anchor"></a>An introduction to the package medrc</h1>
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p>The analysis of dose-response experiments using nonlinear models allows inference about the model parameters and the prediction of new response values. A common way to summarize the effect of an increasing dose level on the response is deriving parameters from the dose-response curve, like the effective dose <span class="math inline">\(ED(p)\)</span>. Also the comparison of several curves by selectivity indices, like the relative potency, is available. For risk estimation in toxicology the estimation of benchmark dose (BMD) levels is a further important topic that is based on the nonlinear modeling of dose-response curves.</p>
<p>The drc package [Ritz et al., 2015] allows the simultaneous fitting of several non-linear regression models, providing a common parameterization for several models and searching automatically for starting values. Several functions are available for model-averaging and inference of derived parameters.</p>
<p>When analyzing dose-response curves, the observed data is often obtained from experiments with hierarchical designs, where the responses can be assigned to several known clusters. Instead of just assuming a single residual error in the dose-response model, the variability within and between clusters can be modeled. Either additional correlation parameters can be introduced to structure the residual error by generalized nonlinear least squares estimation or a distribution function for the cluster effects can be assumed separately to the distribution of the residuals in a mixed model framework.</p>
<p>The nlme package [Pinheiro and Bates, 2000] provides functions to estimate parameters and variance components in nonlinear mixed models by (restricted) maximum likelihood. Some functions to parameterize the non-linear curve are already available, but it is also possible to provide your own modeling function.</p>
<p>The medrc combines the automated dose-response modeling framework of the package drc with the nonlinear mixed estimation framework of the package nlme. Thereby, additional random effects can be introduced to the dose-response models with the unified parameterization of drc, with the availability of inference for derived parameters also for hierarchical models.</p>
</div>
<div id="hierarchical-dose-response-models" class="section level2">
<h2 class="hasAnchor">
<a href="#hierarchical-dose-response-models" class="anchor"></a>Hierarchical dose-response models</h2>
<p>Following the notation of Davidian and Giltinan (1995, 2003), a nonlinear regression model with a single hierarchical level can be defined in two stages that parameterize the intra- and inter-curve specific variation, respectively.</p>
<p><strong>Stage 1</strong>: For the <em>i</em>th individual (<span class="math inline">\(i=1,\dots,m\)</span>), we assume the following nonlinear regression model: <span class="math display">\[ y_{ij} = f(x_{ij}, \boldsymbol{\beta}_{i}) + \epsilon_{ij} \]</span> where <span class="math inline">\(\{y_{i1}, \ldots, y_{i n_i} \}\)</span> and <span class="math inline">\(\{x_{i1}, \ldots, x_{i n_i} \}\)</span> denote the vectors of response values and dose levels, respectively. The population mean dose-response curve is characterized by the dose-response function <span class="math inline">\(f\)</span> through curve-specific effect <span class="math inline">\(\boldsymbol{\beta}_{i}\)</span> (a <span class="math inline">\(q \times 1\)</span> vector). The residual error <span class="math inline">\(\epsilon_i\)</span> is assumed to be mean-zero normally distributed with variance-covariance matrix <span class="math inline">\(\boldsymbol{\Lambda}_{i}\)</span>, which in practice often is assumed to be <span class="math inline">\(\sigma^2 I_{n_i}\)</span> or <span class="math inline">\(diag(\sigma_1^2, \ldots, \sigma_{n_i}^2)\)</span>.</p>
<p><strong>Stage 2</strong>: The inter-curve variation is captured by splitting the curve-specific effect <span class="math inline">\(\boldsymbol{\beta}_{i}\)</span> into components describing the systematic and random variation between curves: <span class="math display">\[ \boldsymbol{\beta}_{i} = \boldsymbol{A}_{i}\boldsymbol{\beta} + \boldsymbol{B}_{i}\boldsymbol{b}_{i} \]</span> where <span class="math inline">\(\boldsymbol{A}_{i}\)</span> and <span class="math inline">\(\boldsymbol{B}_{i}\)</span> denote the fixed-effects and random-effects design matrices, respectively, <span class="math inline">\(\boldsymbol{\beta}\)</span> denotes the fixed-effects parameters (a <span class="math inline">\(p \times 1\)</span> vector with <span class="math inline">\(p \le q\)</span>), and the <span class="math inline">\(b_i\)</span>’s denote the curve-specific random effects. The random effects can be assumed to follow a mean-zero normal distribution with a variance-covariance matrix denoted <span class="math inline">\(\boldsymbol{G}\)</span>, which usually simply is the unstructured matrix.</p>
<p>We restrict our model to a fixed effects parameterization of independent curves, using a dummy 0 and 1 coded design matrix <span class="math inline">\(\boldsymbol{A}_{i}\)</span>, and allowing only random intercepts additively on the fixed effects parameters to represent the subject variability. This hierarchical model will cover many experimental settings in bioassay analysis and toxicology, like the comparison of several treatments in a dose-response experiment, where the responses are repeated measurements on the same experimental units or the experimental design consists of several blocks.</p>
<div id="the-metadrm-function" class="section level3">
<h3 class="hasAnchor">
<a href="#the-metadrm-function" class="anchor"></a>The metadrm function</h3>
<p>A flexible two-stage estimation approach is available with the function , that combines estimates from individual  fits using the R package  [Viechtbauer, 2010]. As a restriction, the  function can include only a single random grouping factor in the second stage.</p>
</div>
<div id="the-medrm-function" class="section level3">
<h3 class="hasAnchor">
<a href="#the-medrm-function" class="anchor"></a>The medrm function</h3>
<p>To fit a hierarchical dose-response model with the Lindstrom-Bates algorithm, the medrm function provides a wrapper around the function nlme (package nlme), providing a function interface similar to drc, but adding a random and correlation argument to define the hierarchical structure of the experimental design.</p>
</div>
</div>
<div id="inference-for-derived-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#inference-for-derived-parameters" class="anchor"></a>Inference for derived parameters</h2>
<p>Instead of interpreting the model parameters directly, we can set focus on derived parameters, like the effective dose at a specific level <span class="math inline">\(ED(p)\)</span> or the ratio of two effective doses, known as relative potency. The effective dose <span class="math inline">\(ED(p)\)</span> is defined as the solution to the following inverse regression problem: <span class="math display">\[ f(ED(p), \boldsymbol{\beta}) = \frac{p}{100} f(\infty, \boldsymbol{\beta}_{i}) + \left( 1 - \frac{p}{100} \right) f(0, \boldsymbol{\beta}_{i}) \]</span> By definition <span class="math inline">\(ED(p)\)</span> values are relative quantities, relative to the lower and upper limits <span class="math inline">\(\beta_2\)</span> and <span class="math inline">\(\beta_3\)</span>, which corresponds to <span class="math inline">\(f(0, \boldsymbol{\beta}_{i})\)</span> and <span class="math inline">\(f(\infty, \boldsymbol{\beta}_{i})\)</span>, respectively, if <span class="math inline">\(\beta_1&lt;0\)</span> (otherwise <span class="math inline">\(\beta_2\)</span> and <span class="math inline">\(\beta_3\)</span> swap places). The function <em>ED()</em> of package <em>drc</em> can be directly used with an medrc object to calculate the effective dose at (multiple) response levels conditional on random effects being equal to zero. Inference for the <span class="math inline">\(ED(p)\)</span> parameters, like hypotheses tests or corresponding confidence intervals, are available by using the Delta-method to approximate the variance-covariance of the derived parameters.</p>
<p>Another important concept used for summarizing dose-response data is the benchmark dose methodology. Ritz et al. (2013) proposed an operational definition of the benchmark dose concept for continuous endpoints, allowing for the incorporation of an a priori specified background level <span class="math inline">\(p_0\)</span> and benchmark response of interest <em>BMR</em>. The resulting BMD is obtained by solving the following equation:</p>
<p><span class="math display">\[ \left[ \Phi^{-1}(1-p_0) - \Phi^{-1}\{1-(p_0+BMR)\} \right] \frac{\sigma}{f(\infty,\boldsymbol{\beta}_{i}) - f(0,\boldsymbol{\beta}_{i})} = \frac{f(BMD,\boldsymbol{\beta}_{i}) - f(0,\boldsymbol{\beta}_{i})}{f(\infty,\boldsymbol{\beta}_{i}) - f(0,\boldsymbol{\beta}_{i})}. \]</span> By ignoring the variability in the ratio <span class="math inline">\(\sigma \{f(\infty,\boldsymbol{\beta}_{i}) - f(0,\boldsymbol{\beta}_{i})\}^{-1}\)</span> this definition implies that benchmark doses may be derived in the same way as ordinary effective doses defined above by specifying the non-standard response level. The function <em>BMD()</em> enables the computation of the BMD and lower confidence bounds (BMDL) for a medrc object, given the benchmark risk and a background risk level.</p>
<div id="model-averaged-estimates" class="section level3">
<h3 class="hasAnchor">
<a href="#model-averaged-estimates" class="anchor"></a>Model-averaged estimates</h3>
<p>By specifying the nonlinear function <span class="math inline">\(f(x_{ij}, \boldsymbol{\beta}_{i})\)</span> the principle shape of the curve is treated as known. Without any prior knowledge about the progress of the dose-response curve it is reasonable to choose from a larger set of dose-response models instead of assuming a single fixed function. With a set of candidate models a specific dose-response relationship can be selected based on the data, or model averaging approaches can be used to incorporate the model uncertainty into the parameter inference.</p>
<p>The framework of package drc allows to fit several dose-response models to the same data in an automated fashion, with several, predefined dose-response curves, all of them composed of a similar set of similar defined parameters with lower and upper asymptotes, steepness, inflection points, etc. As these model functions can be directly used in medrc, the formula interfaces enable the composition of a set of models with different fixed and random effect parameterizations and different dose-response shapes.</p>
<p>Model-averaged inference for the effective dose is available by the function <em>mmaED()</em>, allowing the input of several medrc model objects. By default the model parameters are estimated by maximum likelihood; it is not adviced to use the model averaging approach with REML estimates. Furthermore, only models with changes in the fixed effect parameterization OR the random effect structure should be combined.</p>
</div>
</div>
<div id="case-studies" class="section level2">
<h2 class="hasAnchor">
<a href="#case-studies" class="anchor"></a>Case Studies</h2>
<div id="vinclozolin-example" class="section level3">
<h3 class="hasAnchor">
<a href="#vinclozolin-example" class="anchor"></a>Vinclozolin example</h3>
<p>Nellemann et al. (2003) carried out experiments to assess the in vitro effects of the fungicide vinclozolin. The data were obtained using an androgen receptor reporter gene assay, which was repeated six times (on different days). Each assay resulted in concentration-response data with nine concentrations (in <span class="math inline">\(\mu\)</span> M) of the fungicide, and the response measured was chemiluminescence (in luminescence units), so the same nine concentrations were used in all six assays. However, in one assay, only eight concentrations were used.</p>
<p>The dataset is available in the package drc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(vinclozolin)</code></pre></div>
<p>Assuming a lower asymptote at 0 for the control, a three parameter log-logistic model can be assumed, estimating the upper asymptote, location of the inflection point, and steepness of the curve. The assay effect is treated as a normally distributed random effect, summarizing the between-assay variability by a <span class="math inline">\((3 \times 3)\)</span> covariance matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># meta analysis approach</span>
m1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/metadrm.html">metadrm</a></span>(effect <span class="op">~</span><span class="st"> </span>conc,
              <span class="dt">data=</span>vinclozolin,
              <span class="dt">fct=</span><span class="kw">LL.3</span>(),
              <span class="dt">ind=</span>exper,
              <span class="dt">struct=</span><span class="st">"UN"</span>)
<span class="kw">summary</span>(m1)</code></pre></div>
<pre><code>## 
## Two-stage meta-analysis dose-response model
## Model fitted: Log-logistic (ED50 as parameter) with lower limit at 0
## 
## Call:
## metadrm(formula = effect ~ conc, fct = LL.3(), ind = exper, data = vinclozolin, 
##     struct = "UN")
## 
## Variance estimates:
##                  estim      sqrt
## tau^2.1         0.0316    0.1779
## tau^2.2    687783.0025  829.3268
## tau^2.3         0.0069    0.0830
## 
##                rho.b:(I  rho.d:(I  rho.e:(I
## b:(Intercept)         1   -0.8745    0.9315
## d:(Intercept)   -0.8745         1   -0.6382
## e:(Intercept)    0.9315   -0.6382         1
## 
## 
## Coefficients:
##                 Estimate    Std.Err t value  Pr(&gt;|t|)    
## b:(Intercept) 5.4042e-01 7.8816e-02  6.8567 5.444e-06 ***
## d:(Intercept) 1.9684e+03 3.4108e+02  5.7711 3.692e-05 ***
## e:(Intercept) 1.0312e-01 3.6090e-02  2.8573   0.01199 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># nonlinear mixed-effects model</span>
m2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/medrm.html">medrm</a></span>(effect <span class="op">~</span><span class="st"> </span>conc, <span class="dt">data=</span>vinclozolin,
            <span class="dt">random=</span>b <span class="op">+</span><span class="st"> </span>d <span class="op">+</span><span class="st"> </span>e <span class="op">~</span><span class="st"> </span><span class="dv">1</span><span class="op">|</span>exper,
            <span class="dt">fct=</span><span class="kw">LL.3</span>(), <span class="dt">start=</span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">2000</span>, <span class="fl">0.05</span>))
<span class="kw">summary</span>(m2)</code></pre></div>
<pre><code>## Nonlinear mixed-effects model fit by maximum likelihood
##   Model: effect ~ meLL.3(conc, b, d, e) 
##  Data: data 
##        AIC      BIC    logLik
##   701.4922 721.1951 -340.7461
## 
## Random effects:
##  Formula: list(b ~ 1, d ~ 1, e ~ 1)
##  Level: exper
##  Structure: General positive-definite, Log-Cholesky parametrization
##          StdDev       Corr         
## b          0.15223468 b      d     
## d        758.88844284 -0.893       
## e          0.06969997  0.859 -0.537
## Residual 100.08932805              
## 
## Fixed effects: b + d + e ~ 1 
##       Value Std.Error DF  t-value p-value
## b    0.5382    0.0706 45 7.625316  0.0000
## d 1987.3050  321.4828 45 6.181683  0.0000
## e    0.1014    0.0322 45 3.144827  0.0029
##  Correlation: 
##   b      d     
## d -0.819       
## e  0.811 -0.517
## 
## Standardized Within-Group Residuals:
##         Min          Q1         Med          Q3         Max 
## -1.94016266 -0.51822539 -0.09182678  0.49873493  2.20628241 
## 
## Number of Observations: 53
## Number of Groups: 6</code></pre>
<p>The effective doses can be estimated at several response levels, conditional on random effects being equal to zero, using the function <em>ED()</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ED</span>(m1, <span class="dt">respLev=</span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">50</span>, <span class="dv">85</span>))</code></pre></div>
<pre><code>## 
## Estimated effective doses
## 
##        Estimate Std. Error
## e::15 0.0041628  0.0032620
## e::50 0.1031209  0.0360903
## e::85 2.5545035  0.6718647</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ED</span>(m2, <span class="dt">respLev=</span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">50</span>, <span class="dv">85</span>))</code></pre></div>
<pre><code>## 
## Estimated effective doses
## 
##         Estimate Std. Error
## e:1:15 0.0040369  0.0027667
## e:1:50 0.1013631  0.0313062
## e:1:85 2.5451269  0.6139681</code></pre>
<p>medrc provides an automated plot method for the nlme objects using ggplot2.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(m2, <span class="dt">logx=</span><span class="ot">TRUE</span>, <span class="dt">ndose=</span><span class="dv">25</span>, <span class="dt">ranef=</span><span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="medrc_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
</div>
<div id="spinach-example" class="section level3">
<h3 class="hasAnchor">
<a href="#spinach-example" class="anchor"></a>Spinach example</h3>
<p>Streibig and Dayan (1999) investigated the inhibition of photosynthesis in response to two synthetic photosystem II inhibitors, the herbicides diuron and bentazon. In an experiment, the effect of oxygen consumption of thylakoid membranes (chloroplasts) from spinach was measured after incubation with the synthetic inhibitors in five assays, three treated with bentazon and two with diuron. For each assay six increasing herbicide concentrations were applied together with a negative control, using different dose ranges on a logarithmic scale for the two treatments based on preliminary experiments to encompass the whole dose-response range.</p>
<p>The dataset is available in the package drc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(spinach)
spinach<span class="op">$</span>CURVE &lt;-<span class="st"> </span><span class="kw">as.factor</span>(spinach<span class="op">$</span>CURVE)</code></pre></div>
<p>For the comparison of the two herbicides, two dose-response curves are fitted under assumption of a three parameter log-logistic model with a separate set of fixed effects coefficients for each treatment. Random effects are included for each of the three parameters to model the between assay variability. Using the information of the between assay variability by the additional distributional assumptions of the random intercepts is especially advantageous, as the dose levels for the two herbicides do not cover the same dose range.</p>
<p>As for the Vinclozolin example, either a nonlinear mixed model or a generalized nonlinear least-squares model can be fitted.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># meta analysis approach</span>
sm1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/metadrm.html">metadrm</a></span>(SLOPE <span class="op">~</span><span class="st"> </span>DOSE, 
               <span class="dt">data=</span>spinach,
               <span class="dt">fct=</span><span class="kw">LL.3</span>(),
               <span class="dt">ind=</span>CURVE,
               <span class="dt">cid2=</span>HERBICIDE,
               <span class="dt">struct=</span><span class="st">"UN"</span>)
<span class="kw">summary</span>(sm1)</code></pre></div>
<pre><code>## 
## Two-stage meta-analysis dose-response model
## Model fitted: Log-logistic (ED50 as parameter) with lower limit at 0
## 
## Call:
## metadrm(formula = SLOPE ~ DOSE, fct = LL.3(), ind = CURVE, data = spinach, 
##     cid2 = HERBICIDE, struct = "UN")
## 
## Variance estimates:
##             estim    sqrt
## tau^2.1    0.0005  0.0221
## tau^2.2    0.1856  0.4308
## tau^2.3    0.0000  0.0009
## 
##                rho.b:(I  rho.d:(I  rho.e:(I
## b:(Intercept)         1    1.0000   -1.0000
## d:(Intercept)    1.0000         1   -1.0000
## e:(Intercept)   -1.0000   -1.0000         1
## 
## 
## Coefficients:
##             Estimate   Std.Err t value  Pr(&gt;|t|)    
## b:bentazon 0.5021926 0.0252658 19.8764 9.590e-09 ***
## b:diuron   1.6572431 0.1154678 14.3524 1.654e-07 ***
## d:bentazon 1.3091412 0.2495357  5.2463 0.0005303 ***
## d:diuron   1.9858581 0.3056732  6.4967 0.0001119 ***
## e:bentazon 1.7452319 0.1716524 10.1672 3.116e-06 ***
## e:diuron   0.2086242 0.0091462 22.8100 2.840e-09 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">### nlme
sm2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/medrm.html">medrm</a></span>(SLOPE <span class="op">~</span><span class="st"> </span>DOSE, 
             <span class="dt">curveid=</span>b <span class="op">+</span><span class="st"> </span>d <span class="op">+</span><span class="st"> </span>e <span class="op">~</span><span class="st"> </span>HERBICIDE, 
             <span class="dt">data=</span>spinach, 
             <span class="dt">fct=</span><span class="kw">LL.3</span>(), 
             <span class="dt">random =</span> b <span class="op">+</span><span class="st"> </span>d <span class="op">+</span><span class="st"> </span>e <span class="op">~</span><span class="st"> </span><span class="dv">1</span><span class="op">|</span>CURVE,
             <span class="dt">start=</span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>, <span class="fl">0.3</span>))
<span class="kw">summary</span>(sm2)</code></pre></div>
<pre><code>## Nonlinear mixed-effects model fit by maximum likelihood
##   Model: SLOPE ~ meLL.3(DOSE, b, d, e) 
##  Data: data 
##         AIC       BIC   logLik
##   -200.9121 -166.4107 113.4561
## 
## Random effects:
##  Formula: list(b ~ 1, d ~ 1, e ~ 1)
##  Level: CURVE
##  Structure: General positive-definite, Log-Cholesky parametrization
##               StdDev       Corr         
## b.(Intercept) 1.936461e-02 b.(In) d.(In)
## d.(Intercept) 3.294869e-01 1            
## e.(Intercept) 4.173550e-12 0      0     
## Residual      7.278869e-02              
## 
## Fixed effects: list(b ~ HERBICIDE - 1, d ~ HERBICIDE - 1, e ~ HERBICIDE - 1) 
##                         Value  Std.Error DF   t-value p-value
## b.HERBICIDEbentazon 0.5028197 0.02830093 95 17.766899       0
## b.HERBICIDEdiuron   1.6587325 0.08678366 95 19.113418       0
## d.HERBICIDEbentazon 1.3105896 0.19737050 95  6.640251       0
## d.HERBICIDEdiuron   1.9859080 0.24078961 95  8.247482       0
## e.HERBICIDEbentazon 1.8477691 0.20496373 95  9.015103       0
## e.HERBICIDEdiuron   0.2085488 0.00749736 95 27.816304       0
##  Correlation: 
##                     b.HERBICIDEb b.HERBICIDEd d.HERBICIDEb d.HERBICIDEd
## b.HERBICIDEdiuron    0.000                                             
## d.HERBICIDEbentazon  0.372        0.000                                
## d.HERBICIDEdiuron    0.000        0.125        0.000                   
## e.HERBICIDEbentazon  0.412        0.000       -0.082        0.000      
## e.HERBICIDEdiuron    0.000        0.228        0.000       -0.042      
##                     e.HERBICIDEb
## b.HERBICIDEdiuron               
## d.HERBICIDEbentazon             
## d.HERBICIDEdiuron               
## e.HERBICIDEbentazon             
## e.HERBICIDEdiuron    0.000      
## 
## Standardized Within-Group Residuals:
##          Min           Q1          Med           Q3          Max 
## -3.255291696 -0.517514826 -0.005061123  0.617135693  2.694079415 
## 
## Number of Observations: 105
## Number of Groups: 5</code></pre>
<p>The two fixed effect curves are compared by the ratio of effective dose estimates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cmat &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), 
              <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), 
              <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))

<span class="co"># comparing effective dose levels for meta analysis</span>
<span class="kw">EDcomp</span>(sm1, 
       <span class="dt">percVec=</span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">50</span>, <span class="dv">85</span>), 
       <span class="dt">percMat=</span>cmat, 
       <span class="dt">interval=</span><span class="st">"fieller"</span>)</code></pre></div>
<pre><code>## 
## Estimated ratios of effect doses
## 
##                        Estimate     Lower     Upper
## bentazon/diuron:15/15   0.75332   0.40454   1.15956
## bentazon/diuron:50/50   8.36543   6.39896  10.49810
## bentazon/diuron:85/85  92.89635  49.81637 143.18800</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># comparing effective dose levels for nlme</span>
<span class="kw">EDcomp</span>(sm2, 
       <span class="dt">percVec=</span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">50</span>, <span class="dv">85</span>), 
       <span class="dt">percMat=</span>cmat, 
       <span class="dt">interval=</span><span class="st">"fieller"</span>)</code></pre></div>
<pre><code>## 
## Estimated ratios of effect doses
## 
##                        Estimate     Lower     Upper
## bentazon/diuron:15/15   0.80056   0.39510   1.23745
## bentazon/diuron:50/50   8.86013   6.90605  10.89971
## bentazon/diuron:85/85  98.05903  63.37847 135.24172</code></pre>
<p>The predicted curves can be plotted:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(tidyr)
pdata &lt;-<span class="st"> </span>spinach <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(CURVE, HERBICIDE) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/expand">expand</a></span>(<span class="dt">DOSE=</span><span class="kw">exp</span>(<span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">length=</span><span class="dv">50</span>)))
pdata<span class="op">$</span>SLOPEind &lt;-<span class="st"> </span><span class="kw">predict</span>(sm2, <span class="dt">newdata=</span>pdata)
pdata<span class="op">$</span>SLOPE &lt;-<span class="st"> </span><span class="kw">predict</span>(sm2, <span class="dt">newdata=</span>pdata, <span class="dt">level=</span><span class="dv">0</span>)

<span class="kw">ggplot</span>(spinach, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">log</span>(DOSE), <span class="dt">y=</span>SLOPE, 
                    <span class="dt">colour=</span>HERBICIDE, <span class="dt">group=</span>CURVE, <span class="dt">shape=</span>HERBICIDE)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data=</span>pdata) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data=</span>pdata, <span class="kw">aes</span>(<span class="dt">y=</span>SLOPEind), <span class="dt">linetype=</span><span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">"DOSE"</span>, 
                     <span class="dt">breaks=</span><span class="kw">log</span>(<span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>)), 
                     <span class="dt">labels=</span><span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>))</code></pre></div>
<p><img src="medrc_files/figure-html/spinachplot-1.png" width="672"></p>
</div>
<div id="t3-mouse-fibroblasts-and-nru-assay" class="section level3">
<h3 class="hasAnchor">
<a href="#t3-mouse-fibroblasts-and-nru-assay" class="anchor"></a>3T3 mouse fibroblasts and NRU assay</h3>
<p>The toxicity of sodium valproate was tested, using the 3T3 mouse fibroblasts and neutral red uptake (NRU) assay. 22 different experiments were performed independently in six laboratories, using eight concentration levels, each with six replicates on a 96-well plate. In addition, twelve measurements were taken for the solvent control. See Clothier et al. (2013) for more information.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(mdra)</code></pre></div>
<p>A 3-parameter log-logistic model was fitted with two levels of hierarchical random effects, treating the laboratory effect and the experiment effect on the upper asymptote and on the ED50 parameter as a random effect. In this way, the hierarchical layout of the data is represented, modelling the variability between laboratories and between experiments within a laboratory. No random laboratory or experiment variation is assigned to the slope parameters in order to reduce model complexity and ensure convergence of the parameter estimation algorithm.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mdramod &lt;-<span class="st"> </span><span class="kw"><a href="../reference/medrm.html">medrm</a></span>(Response <span class="op">~</span><span class="st"> </span>Concentration, <span class="dt">data=</span>mdra, <span class="dt">fct=</span><span class="kw">LL.3</span>(), 
           <span class="dt">random=</span>d <span class="op">+</span><span class="st"> </span>e <span class="op">~</span><span class="st"> </span><span class="dv">1</span><span class="op">|</span>LabID<span class="op">/</span>ExperimentID, 
           <span class="dt">weights=</span><span class="kw">varExp</span>(<span class="dt">form=</span><span class="op">~</span>Concentration),
           <span class="dt">control=</span><span class="kw">nlmeControl</span>(<span class="dt">tolerance=</span><span class="fl">0.1</span>, <span class="dt">pnlsTol=</span><span class="dv">1</span>)) 
<span class="kw">plot</span>(mdramod, <span class="dt">logx=</span><span class="ot">TRUE</span>, <span class="dt">ndose=</span><span class="dv">250</span>, <span class="dt">ranef=</span><span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>()</code></pre></div>
<p><img src="medrc_files/figure-html/mdramodel-1.png" width="576"></p>
</div>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<ul>
<li><p>Clothier, R., Gomez-Lechon, M. J., Kinsner-Ovaskainen, A., Kopp-Schneider, A., O’Connor, J. E., Prieto, P., and Stanzel, S. (2013). Comparative analysis of eight cytotoxicity assays evaluated within the ACuteTox Project. <em>Toxicology in vitro</em>, <strong>27</strong>(4):1347–1356.</p></li>
<li><p>Davidian, M. and Giltinan, D. M. (1995). <em>Nonlinear Models for Repeated Measurement Data</em>. Chapman &amp; Hall/CRC Monographs on Statistics &amp; Applied Probability, London.</p></li>
<li><p>Davidian, M. and Giltinan, D. M. (2003). Nonlinear models for repeated measurement data: An overview and update. <em>Journal of Agricultural, Biological, and Environmental Statistics</em>, <strong>8</strong>(4):387–419.</p></li>
<li><p>Nellemann, C., Majken, D., Lam, H. R., and Vinggaard, A. M. (2003). The Combined Effects of Vinclozolin and Procymidone Do Not Deviate from Expected Additivity in Vitro and in Vivo. <em>Toxicological Sciences</em>, <strong>71</strong>(2):251–262.</p></li>
<li><p>Pinheiro, J. C. and Bates, D. M. (2000). <em>Mixed-Effects Models in S and S-Plus</em>. Statistics and Computing. Springer.</p></li>
<li><p>Ritz, C., Gerhard, D., and Hothorn, L. A. (2013). A Unified Framework for Benchmark Dose Estimation Applied to Mixed Models and Model Averaging. <em>Statistics in Biopharmaceutical Research</em>, <strong>5</strong>(1):79–90.</p></li>
<li><p>Ritz, C., Baty, F., Streibig, J. C., &amp; Gerhard, D. (2015). Dose-response analysis using R. <em>PLoS ONE</em>, <strong>10</strong>(12), e0146021. <a href="https://doi.org/10.1371/journal.pone.0146021" class="uri">https://doi.org/10.1371/journal.pone.0146021</a></p></li>
<li><p>Streibig, J. C. and Dayan, F. E. (1999). Joint action of natural and synthetic photosystem II inhibitors. <em>Pesticide Science</em>, <strong>146</strong>(1998):137–146.</p></li>
<li><p>Viechtbauer, W. (2010). Conducting Meta-Analyses in R with the metafor Package. <em>Journal of Statistical Software</em>, <strong>36</strong>(3), 1–48. <a href="https://doi.org/10.18637/jss.v036.i03" class="uri">https://doi.org/10.18637/jss.v036.i03</a></p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#an-introduction-to-the-package-medrc">An introduction to the package medrc</a><ul class="nav nav-pills nav-stacked">
<li><a href="#motivation">Motivation</a></li>
      <li><a href="#hierarchical-dose-response-models">Hierarchical dose-response models</a></li>
      <li><a href="#inference-for-derived-parameters">Inference for derived parameters</a></li>
      <li><a href="#case-studies">Case Studies</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Daniel Gerhard, Christian Ritz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
